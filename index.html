<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporate Organization Chart</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* GENEL SAYFA AYARLARI */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8f9fa; /* √áok a√ßƒ±k gri arka plan */
            margin: 0; 
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        /* √úST MEN√ú VE SE√áƒ∞M ALANI */
        .controls {
            background: white;
            width: 100%;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        select {
            padding: 10px 20px;
            font-size: 15px;
            border: 1px solid #e1e4e8;
            border-radius: 20px;
            background-color: #f1f3f5;
            color: #333;
            cursor: pointer;
            outline: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        select:hover {
            background-color: #e9ecef;
        }

        /* ≈ûEMA ALANI */
        #chart_div { 
            width: 100%; 
            height: 100%;
            overflow: auto; /* Mobilde kaydƒ±rma a√ßar */
            text-align: center;
            padding-top: 30px;
            padding-bottom: 100px;
            /* Dokunmatik ekranlarda kaydƒ±rmayƒ± yumu≈üatƒ±r */
            -webkit-overflow-scrolling: touch; 
        }

        /* --- GOOGLE CHARTS √ñZELLE≈ûTƒ∞RME (EN √ñNEMLƒ∞ KISIM) --- */
        
        /* Tablo √ßizgilerini temizle */
        table { border-collapse: separate !important; border-spacing: 0 !important; }

        /* Baƒülantƒ± √ßizgileri rengi */
        .google-visualization-orgchart-lineleft, 
        .google-visualization-orgchart-lineright, 
        .google-visualization-orgchart-linebottom { 
            border-color: #cbd5e1 !important; 
            border-width: 2px !important;
        }

        /* KART TASARIMI */
        .google-visualization-orgchart-node {
            background: #ffffff; 
            border: none !important; /* Eski kenarlƒ±ƒüƒ± kaldƒ±r */
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.1); 
            padding: 0 !important;
            width: 180px; 
            transition: all 0.3s ease;
            cursor: pointer;
        }

        /* Kartƒ±n √ºzerine gelince */
        .google-visualization-orgchart-node:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
            z-index: 999;
        }

        /* Se√ßili/Tƒ±klanmƒ±≈ü Kart */
        .google-visualization-orgchart-node-medium {
            vertical-align: middle;
            text-align: center;
        }

        /* ƒ∞√áERƒ∞K D√úZENƒ∞ */
        .node-content {
            padding: 15px 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* √ñnce UNVAN (Title) */
        .title-text { 
            font-size: 11px; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #64748b; /* Gri renk */
            margin-bottom: 6px;
            font-weight: 600;
        }

        /* Sonra ƒ∞Sƒ∞M (Name) */
        .name-text { 
            font-size: 14px; 
            font-weight: 700; 
            color: #1e293b; /* Koyu lacivert/siyah */
            line-height: 1.4;
        }

        /* Y√ºkleniyor yazƒ±sƒ± */
        #loading {
            margin-top: 50px;
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
        }

        /* MOBƒ∞L UYUM (Responsive) */
        @media (max-width: 768px) {
            .google-visualization-orgchart-node {
                width: 140px; /* Mobilde kutular biraz daha dar olsun */
            }
            .name-text { font-size: 13px; }
            .title-text { font-size: 10px; }
        }
    </style>
</head>
<body>

    <div class="controls">
        <select id="locationSelect" onchange="filterAndDraw()">
            <option value="Istanbul">üìç Istanbul HQ</option>
            <option value="Malkara">üè≠ Malkara Production</option>
        </select>
    </div>

    <div id="chart_div">
        <div id="loading">Loading organization chart...</div>
    </div>

    <script type="text/javascript">
        // -----------------------------------------------------------
        // BURAYA CSV LINKINI YAPISTIR
        const csvLink = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS53ndrTBAgFEdi_57aoGwMsWukrhbuOaMUpk8haK7cB4Kc_kZVqfCLQ_OQGOWA4W-uc8PU4AMt5i3P/pub?gid=0&single=true&output=csv";
        // -----------------------------------------------------------

        let allData = []; 

        google.charts.load('current', {packages:["orgchart"]});
        google.charts.setOnLoadCallback(fetchData);

        function fetchData() {
            Papa.parse(csvLink, {
                download: true,
                header: true,
                complete: function(results) {
                    allData = results.data;
                    filterAndDraw();
                },
                error: function(err) {
                    document.getElementById('loading').innerText = "Error loading data.";
                }
            });
        }

        function filterAndDraw() {
            const selectedLocation = document.getElementById('locationSelect').value;
            const chartDiv = document.getElementById('chart_div');
            
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Name');
            data.addColumn('string', 'Manager');
            data.addColumn('string', 'ToolTip');

            var filteredData = allData.filter(item => item.Lokasyon && item.Lokasyon.trim() === selectedLocation);

            if (filteredData.length === 0) {
                chartDiv.innerHTML = "<div id='loading'>No data found.</div>";
                return;
            }

            var chartRows = filteredData.map(item => {
                return [
                    { 
                        v: item.ID, 
                        f: `<div class="node-content">
                                <div class="title-text">${item.Title}</div>
                                <div class="name-text">${item.ID}</div>
                            </div>` 
                    },
                    item.Manager_ID ? item.Manager_ID : '', 
                    item.Title
                ];
            });

            data.addRows(chartRows);

            var chart = new google.visualization.OrgChart(chartDiv);
            
            // AYARLAR
            chart.draw(data, {
                'allowHtml': true, 
                'allowCollapse': true, // ƒ∞NTERAKTƒ∞FLƒ∞K: √áift tƒ±klayƒ±nca kapanƒ±r
                'size': 'medium',
                'nodeClass': 'google-visualization-orgchart-node',
                'selectedNodeClass': 'google-visualization-orgchart-node' // Se√ßilince stil bozulmasƒ±n
            });
        }
    </script>
</body>
</html>
