<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pameks Organization Chart</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* PAMEKS KURUMSAL RENKLERƒ∞ */
            --pameks-blue: #0f2b4c; /* Koyu Lacivert */
            --pameks-red: #e30613;  /* Logodaki Kƒ±rmƒ±zƒ± */
            --bg-color: #eef2f6;    /* A√ßƒ±k Gri Zemin */
        }

        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: var(--bg-color);
            margin: 0; 
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Sayfa kaymasƒ±n, sadece ≈üema kaysƒ±n */
        }

        /* --- √úST KONTROL PANELI --- */
        .header {
            background: #fff;
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 3px solid var(--pameks-red);
        }

        select {
            padding: 12px 30px;
            font-size: 15px;
            font-weight: 700;
            color: var(--pameks-blue);
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            background-color: #fff;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        select:hover {
            border-color: var(--pameks-blue);
            box-shadow: 0 4px 10px rgba(15, 43, 76, 0.15);
        }

        /* --- ≈ûEMA ALANI --- */
        #chart_div { 
            flex: 1;
            width: 100%; 
            overflow: auto; /* Kaydƒ±rma a√ßƒ±k */
            padding-top: 40px;
            padding-bottom: 100px;
            text-align: center;
            cursor: grab;
            background-image: radial-gradient(#dfe3eb 1px, transparent 1px);
            background-size: 20px 20px; /* Arkada teknik √ßizim hissi veren noktalar */
        }
        
        #chart_div:active { cursor: grabbing; }

        /* --- GOOGLE CHARTS OVERRIDE (Sƒ∞Hƒ∞RLƒ∞ KISIM) --- */
        
        table { border-collapse: separate !important; border-spacing: 0 !important; margin: 0 auto; }

        /* √áizgilerin Rengi */
        .google-visualization-orgchart-lineleft, 
        .google-visualization-orgchart-lineright, 
        .google-visualization-orgchart-linebottom { 
            border-color: #b0b8c1 !important; 
            border-width: 2px !important;
        }

        /* KART TASARIMI */
        .google-visualization-orgchart-node {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            padding: 0 !important;
            width: 200px; /* Geni≈ü kartlar */
        }

        /* Kartƒ±n ƒ∞√ßeriƒüi */
        .card-box {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 10px 15px rgba(0,0,0,0.03);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            border-top: 4px solid var(--pameks-blue); /* √úst √ßizgi */
        }

        /* Hover Efekti: Kart yukarƒ± kalkar */
        .google-visualization-orgchart-node:hover .card-box {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(15, 43, 76, 0.15);
            border-top-color: var(--pameks-red); /* √úst √ßizgi kƒ±rmƒ±zƒ± olur */
        }

        /* ƒ∞√ßerik D√ºzeni */
        .card-content {
            padding: 15px;
        }

        /* UNVAN (√ústte) */
        .title-text { 
            font-size: 11px; 
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #8898aa;
            font-weight: 700;
            margin-bottom: 8px;
            display: block;
        }

        /* ƒ∞Sƒ∞M (Altta) */
        .name-text { 
            font-size: 15px; 
            font-weight: 800; 
            color: var(--pameks-blue);
            line-height: 1.3;
        }

        /* Y√ºkleniyor Yazƒ±sƒ± */
        #loading {
            margin-top: 100px;
            font-size: 18px;
            color: var(--pameks-blue);
            font-weight: 500;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        /* Se√ßili Kartƒ±n Rengi Bozulmasƒ±n */
        .google-visualization-orgchart-node-medium {
            vertical-align: top;
        }
        
    </style>
</head>
<body>

    <div class="header">
        <select id="locationSelect" onchange="filterAndDraw()">
            <option value="Istanbul">üè¢ ISTANBUL HEADQUARTERS</option>
            <option value="Malkara">üè≠ MALKARA PRODUCTION</option>
        </select>
    </div>

    <div id="chart_div">
        <div id="loading">System Loading...</div>
    </div>

    <script type="text/javascript">
        // -----------------------------------------------------------
        // BURAYA CSV LINKINI YAPISTIR
        const csvLink = "BURAYA_GOOGLE_SHEET_CSV_LINKINI_YAPISTIR";
        // -----------------------------------------------------------

        let allData = []; 

        google.charts.load('current', {packages:["orgchart"]});
        google.charts.setOnLoadCallback(fetchData);

        function fetchData() {
            Papa.parse(csvLink, {
                download: true,
                header: true,
                complete: function(results) {
                    allData = results.data;
                    filterAndDraw();
                },
                error: function(err) {
                    document.getElementById('loading').innerText = "Data Load Error.";
                }
            });
        }

        function filterAndDraw() {
            const selectedLocation = document.getElementById('locationSelect').value;
            const chartDiv = document.getElementById('chart_div');
            
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Name');
            data.addColumn('string', 'Manager');
            data.addColumn('string', 'ToolTip');

            var filteredData = allData.filter(item => item.Lokasyon && item.Lokasyon.trim() === selectedLocation);

            if (filteredData.length === 0) {
                chartDiv.innerHTML = "<div id='loading'>No data found.</div>";
                return;
            }

            var chartRows = filteredData.map(item => {
                return [
                    { 
                        v: item.ID, 
                        f: `<div class="card-box">
                                <div class="card-content">
                                    <div class="title-text">${item.Title}</div>
                                    <div class="name-text">${item.ID}</div>
                                </div>
                            </div>` 
                    },
                    item.Manager_ID ? item.Manager_ID : '', 
                    item.Title
                ];
            });

            data.addRows(chartRows);

            var chart = new google.visualization.OrgChart(chartDiv);
            
            chart.draw(data, {
                'allowHtml': true, 
                'allowCollapse': true, 
                'size': 'medium',
                'nodeClass': 'google-visualization-orgchart-node',
                'selectedNodeClass': 'google-visualization-orgchart-node' 
            });
        }
    </script>
</body>
</html>
